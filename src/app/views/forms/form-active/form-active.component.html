<div class="" id="form-active">
  <ng-container>
    <!-- {{ formBody | json }} -->
    <div class="container-fluid px-0">
      <div class="d-flex body">

        <div class="structure col-3 border">
          <div class="card">
            <div class="card-header">
              <p class="text-primary-ab px-4 mt-4">{{ "Infroamtion" | titlecase }}</p>
              <!-- <p class="text-primary">-- {{ formSelected | json }} -- {{ actionSelected | json }} --</p> -->
              <div class="m-4 p-2">
                <div class="d-flex flex-column">
                  <label class="text-primary-ab" for="uuid">UUID</label>
                  <div class="input-group">
                    <input type="text" for="uuid" class="form-control shadow-sm mb-3" disabled [(ngModel)]="formBody.uuid" placeholder="uuid">
                    <div class="input-group-append">
                      <span class="input-group-text bg-light" (click)="generateUUID('formBody.uuid')">
                        <i-bs
                          name="arrow-clockwise"
                          class="text-primary-ab"
                          width="24px"
                          height="24px"
                        ></i-bs>
                      </span>
                    </div>
                  </div>
                  <div>
                    <label class="text-primary-ab" for="title">Title</label>
                    <input type="text" for="title" class="form-control shadow-sm mb-3" [ngClass]="{'border border-danger rounded' : !formBody.form_name}" [(ngModel)]="formBody.form_name" placeholder="Nome del form">
                  </div>
                  <div>
                    <label class="text-primary-ab" for="description">Description</label>
                    <textarea class="form-control shadow-sm mb-3" for="description" rows="3" [(ngModel)]="formBody.form_text" placeholder="Nome del form"></textarea>
                  </div>
                  <div>
                    <label class="text-primary-ab" for="form_special">Special form</label>
                    <div class="rounded p-3 text-center " for="form_special" [ngClass]="formBody.form_special ? ' border border-primary text-primary-ab bg-dark-light-ab' : ' border '" (click)="formBody.form_special = !formBody.form_special">
                      {{ formBody.form_special ? 'Special form enabled' : 'Special form disabled' }}
                    </div>
                  </div>
                </div>
              </div>
              <hr>
            </div>
            <!--  -->
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div class="my-auto">
                  <p class="text-primary-ab px-4 mt-4">{{ "Form Types" | titlecase }}</p>
                </div>
                <div class="my-auto">
                  <div class="px-4 mt-4">
                    <label for="filtersT" class="text-primary-ab">Filters</label>
                    <mat-select class=" form-control border border-primary" name="filtersT" id="filtersT" [(ngModel)]="filterFormTypesSelected" (selectionChange)="filterTypesChange('form')">
                      <mat-option [value]="filter.value" *ngFor="let filter of filterTypes; let ifFT = index">{{ ifFT === 0 ? (filter.label + ' form') : ('Form ' + filter.label) }}</mat-option>
                    </mat-select>
                  </div>
                </div>
              </div>
              <div
                id="typesF"
                class="row"
                cdkDropList
                [cdkDropListData]="typesF"
                cdkDropListConnectedTo="forms"
                (cdkDropListDropped)="drop($event)"
              >
                <div
                  *ngFor="let type of typesFormsFiltered; let iTF = index"
                  cdkDrag
                  [cdkDragData]="types"
                  (cdkDragStarted)="dragStart($event, 'typesF', type.uuid, iTF)"
                  class=" list-group px-4 py-3 col-4 "
                  >
                  <!-- [ngClass]="isPow(typesFormsFiltered.length) ? ' col-4 ' : ' col-6  '" -->
                  <div class="list-group-item py-3 shadow-sm">
                    {{ type.label }} {{ type.length > 1 ? '(list)' : null }}
                  </div>
                </div>
              </div>
              <hr>
              <div class="d-flex justify-content-between">
                <div class="my-auto">
                  <p class="text-primary-ab px-4 mt-4">{{ "Action Types" | titlecase }}</p>
                </div>
                <div class="my-auto">
                  <div class="px-4 mt-4">
                    <label for="filtersA" class="text-primary-ab">Filters</label>
                    <mat-select class=" form-control border border-primary" name="filtersA" id="filtersA" [(ngModel)]="filterActionTypesSelected" (selectionChange)="filterTypesChange('action')">
                      <mat-option [value]="filter.value" *ngFor="let filter of filterTypes; let ifAT = index">{{ ifAT === 0 ? (filter.label + ' action') : ('Action ' + filter.label) }}</mat-option>
                    </mat-select>
                  </div>
                </div>
              </div>
              <div
                id="typesA"
                class="row"
                cdkDropList
                [cdkDropListData]="typesA"
                cdkDropListConnectedTo="actions"
                (cdkDropListDropped)="drop($event)"
              >
                <div
                  *ngFor="let type of typesActionsFiltered; let iTA = index"
                  cdkDrag
                  [cdkDragData]="typesA"
                  (cdkDragStarted)="dragStart($event, 'typesA', type.uuid, iTA)"
                  class=" list-group px-4 py-3 col-4"
                  >
                  <!-- [ngClass]="isPow(typesActionsFiltered.length) ? ' col-4 ' : ' col-6  '" -->
                  <div class="list-group-item py-3 shadow-sm">
                    {{ type.label }}
                  </div>
                </div>
              </div>
            </div>
            <!--  -->
            <div class="card-footer d-flex flex-column px-4 mb-5 pb-2">
              <button class="btn btn-lg border border-success bg-success-light-ab w-100 mt-auto text-success" (click)="dialogAlertMessage('Save Form', 'Are you sure you want to save this form?', 'check-circle-fill', 'save-form')">SAVE FORM</button>
              <div class="my-2">&nbsp;</div>
              <button class="btn btn-lg border border-danger bg-danger-light-ab w-100 mt-auto text-danger" (click)="dialogAlertMessage('Delete Form', 'Are you sure you want to delete this form?', 'check-circle-fill', 'save-form')">DELETE FORM</button>
            </div>
          </div>
        </div>
        <div class="structure col border">
          <div class="card">
            <div class="card-body">
              <div class="h-45 overflow-hidden">
                <p class="text-primary-ab px-4 mt-2">{{ "Form Items" | titlecase }}</p>
                <div class="h-100 overflow-scroll">
                  <div
                    id="forms"
                    class="pb-5 pt-3"
                    cdkDropList
                    (mouseover)="hoverForm = true" (mouseout)="hoverForm = false"
                    [cdkDropListData]="forms"
                    (cdkDropListDropped)="drop($event)"
                  >
                    <div class="list-group m-4 shadow-sm border border-danger" *ngIf="!formBody.forms.length">
                      <div class="list-group-item border border-danger text-danger bg-danger-light-ab">
                        <div class="d-flex justify-content-between">
                          <span class="my-auto">No forms</span>
                          <i-bs
                            name="view-list"
                            class="my-auto"
                            width="24px"
                            height="24px"
                          ></i-bs>
                        </div>
                      </div>
                    </div>
                    <div
                      *ngFor="let form of formBody.forms; trackBy: trackByFnF; let iF = index;"
                      cdkDrag
                      (cdkDragStarted)="dragStart($event, 'forms', form?.uuid, iF)"
                      class="list-group m-4 shadow-sm"
                    >
                      <div class="list-group-item" (click)="setSelectedItem(form?.uuid, 'form')" [ngClass]="{' border border-primary ': form?.uuid === formSelected, ' bg-dark-light-ab ' : crColor === form?.color}">
                        <!-- {{ form | json }} -->
                        <div class="form-group">
                          <div class="d-flex my-2">
                            <div class="d-flex my-auto"><span class="text-muted mx-2">Type:</span><span class="text-primary-ab">{{ form?.inputType | titlecase }}</span></div>
                            <div class="d-flex my-auto"><span class="text-muted mx-2">Ref:</span><div [style]="'height: 18px; width: 18px; border-radius: 50%;background-color: ' + form?.color + ' !important;'">&nbsp;</div></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <hr>
              <div class="h-45 overflow-hidden">
                <p class="text-primary-ab px-4 mt-4">{{ "Action Items" | titlecase }}</p>
                <div class="h-100 overflow-scroll">
                  <div
                    id="actions"
                    class="pb-5 pt-3"
                    (mouseover)="hoverAction = true" (mouseout)="hoverAction = false"
                    cdkDropList
                    [cdkDropListData]="actions"
                    (cdkDropListDropped)="drop($event)"
                  >
                    <div class="list-group m-4 shadow-sm border border-danger" *ngIf="!formBody.actions.length">
                      <div class="list-group-item border border-danger text-danger bg-danger-light-ab">
                        <div class="d-flex justify-content-between">
                          <span class="my-auto">No actions</span>
                          <i-bs
                            name="view-list"
                            class="my-auto"
                            width="24px"
                            height="24px"
                          ></i-bs>
                        </div>
                      </div>
                    </div>
                    <div
                      *ngFor="let action of formBody.actions; trackBy: trackByFnA; let iA = index;"
                      cdkDrag
                      (cdkDragStarted)="dragStart($event, 'actions', action?.uuid, iA)"
                      class="list-group m-4 shadow-sm bg-danger"
                    >
                      <div class="list-group-item " (click)="setSelectedItem(action?.uuid, 'action')" [ngClass]="{' border border-primary ': action?.uuid === actionSelected, ' bg-dark-light-ab ' : crColor === action?.color}">
                        <!-- {{ action | json }} -->
                        <div class="form-group">
                          <div class="d-flex my-2">
                            <div class="d-flex my-auto"><span class="text-muted mx-2">Type:</span><span class="text-primary-ab">{{ action?.inputType | titlecase }}</span></div>
                            <div class="d-flex my-auto"><span class="text-muted mx-2">Ref:</span><div [style]="'height: 18px; width: 18px; border-radius: 50%;background-color: ' + action?.color + ' !important;'">&nbsp;</div></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <ng-container *ngIf="(formSelected !== '') || (actionSelected !== '')">
          <div class="structure col-4 border p-3" [@enter1]>

            <div class="card">
              <div class="card-header d-flex justify-content-between">
                <div class="my-auto">
                  <div class="d-flex">
                    <div class="border rounded p-2" matTooltip="Close field" (click)="formSelected = ''; actionSelected = ''">
                      <i-bs
                        name="chevron-double-right"
                        class="text-primary-ab"
                        width="24px"
                        height="24px"
                      ></i-bs>
                    </div>
                    <div class="border rounded p-2 mx-3" matTooltip="Delete field" (click)="((formSelected !== '' && formBody.forms?.length >= 2) || (actionSelected !== '' && formBody.actions?.length >= 2)) ? dialogAlertMessage('Delete Form Item', 'Are you sure you want to permanently delete this field?', 'trash', 'delete') : null">
                      <i-bs
                        name="trash"
                        [ngClass]="((formSelected !== '' && formBody.forms?.length >= 2) || (actionSelected !== '' && formBody.actions?.length >= 2)) ? 'text-primary-ab' : 'text-muted'"
                        width="24px"
                        height="24px"
                      ></i-bs>
                      <!-- formBody.forms -->
                    </div>
                  </div>
                </div>
                <div class="my-auto">
                  <p class="mb-0 my-auto"><span class="text-muted">UUID: </span> <span class="text-primary-ab"> {{ formSelected !== '' ? formSelected : actionSelected }} </span></p>
                </div>
              </div>
              <div class="card-body">
                <p class="text-primary-ab">{{ 'previewing json' | titlecase }}</p>
                <div class="border rounded w-100 h-25 overflow-scroll">
                  <div>
                    <ngx-json-viewer [json]="getItem().clean_element" [expanded]="true"></ngx-json-viewer>
                  </div>
                </div>
                <hr>
                <p class="text-primary-ab">{{ 'edit field/Json properties' | titlecase }}</p>
                <div class="row mt-4">
                  <div class="col-4">
                    <label class="text-primary-ab" for="enabled">Enabled</label>
                    <div class="rounded p-3 text-center border " for="enabled" [ngClass]="getItem().full_element['enabled'] ? ' border border-primary text-primary-ab bg-dark-light-ab ' : ' border '" (click)="getItem().full_element['enabled'] = !getItem().full_element['enabled']">
                      {{ getItem().full_element['enabled'] ? 'Enabled' : 'Not eabled' }}
                    </div>
                  </div>
                  <div class="col-4">
                    <label class="text-primary-ab" for="enabled">Required</label>
                    <div class="rounded p-3 text-center border " for="enabled" [ngClass]="getItem().full_element['required'] ? ' border border-primary text-primary-ab bg-dark-light-ab ' : ' border '" (click)="getItem().full_element['required'] = !getItem().full_element['required']">
                      {{ getItem().full_element['required'] ? 'Required' : 'Not required' }}
                    </div>
                  </div>
                  <div class="col-4">
                    <label class="text-primary-ab" for="enabled">Visible</label>
                    <div class="rounded p-3 text-center border" for="enabled" [ngClass]="getItem().full_element['visible'] ? ' border border-primary text-primary-ab bg-dark-light-ab ' : ' border '" (click)="getItem().full_element['visible'] = !getItem().full_element['visible']">
                      {{ getItem().full_element['visible'] ? 'Visible' : 'Not visible' }}
                    </div>
                  </div>
                  <div class="mt-3">
                    <div
                      *ngIf="
                        getItem().full_element['required'] && !getItem().full_element['visible'] ||
                        getItem().full_element['required'] && !getItem().full_element['enabled']
                      " [@enter2] class="form-control border border-warning text-warning bg-warning-light-ab">
                      <div class="d-flex justify-content-start">
                        <i-bs
                          name="exclamation-triangle-fill"
                          class="text-warning my-auto"
                          width="22px"
                          height="22px"
                        ></i-bs>
                        <span class="pt-1 pl-3">Warining!</span>
                      </div>
                      <hr class="my-3">
                      <span *ngIf="getItem().full_element['required'] && !getItem().full_element['enabled']">Keys <u>"Required"</u> can not set active if <u>"Enabled"</u> is not already disbaled</span>
                      <hr class="my-2" *ngIf="(getItem().full_element['required'] && !getItem().full_element['enabled']) && (getItem().full_element['required'] && !getItem().full_element['visible'])">
                      <span *ngIf="getItem().full_element['required'] && !getItem().full_element['visible']">Keys <u>"Required"</u> can not set active if <u>"Visible"</u> is not already disbaled</span>
                    </div>
                  </div>
                </div>
                <div class="row mt-3" *ngIf="testing">
                  <div class="col-12 form-group">
                    <label for="error">Error</label>
                    <input class="form-control border border-danger text-danger bg-danger-light-ab" type="text" [value]="getItem().full_element['error']" [(ngModel)]="getItem().full_element['error']">
                  </div>
                </div>

                <div class="row mt-3" *ngIf="getItem().full_element['component'] === 'label'">
                  <div class="col-6 form-group">
                    <label class="text-primary-ab">Countries</label>
                    <mat-select class="form-control mb-2" [(ngModel)]="getItem().full_element['options'][0]['value']">
                      <mat-option *ngFor="let country of strapi.countries" [value]="country.value">
                        <p class="mb-0">{{ country.label }}</p>
                      </mat-option>
                    </mat-select>
                  </div>
                  <div class="col-6 form-group">
                    <label class="text-primary-ab">Languages</label>
                    <mat-select class="form-control mb-2" [(ngModel)]="getItem().full_element['options'][1]['value']">
                      <mat-option *ngFor="let language of strapi.languages" [value]="language.value">
                        <p class="mb-0">{{ language.label }}</p>
                      </mat-option>
                    </mat-select>
                  </div>
                </div>
                <div class="row mt-3">
                  <div class="col-12 form-group">
                    <label class="text-primary-ab">Value</label>
                    <!-- <input class="form-control" type="text" [value]="getItem().full_element['value']" [(ngModel)]="getItem().full_element['value']"> -->
                    <input *ngIf="(getItem().full_element['inputType'] !== 'checkbox') && getItem().full_element['inputType'] !== 'button'" class="form-control" [type]="getItem().full_element['type']" [value]="getItem().full_element['value']" [(ngModel)]="getItem().full_element['value']">
                    <div class="" *ngIf="(getItem().full_element['inputType'] === 'checkbox') || getItem().full_element['inputType'] === 'button'">
                      <div class="rounded p-2 text-center " for="enabled" [ngClass]="getItem().full_element['value'] ? ' border border-primary text-primary-ab bg-dark-light-ab' : ' border '" (click)="getItem().full_element['value'] = !getItem().full_element['value']">
                        {{ getItem().full_element['value'] ? getItem().full_element['value'] : false }}
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row mt-3" *ngIf="testing">
                  <div class="col-6 form-group">
                    <label class="text-primary-ab">Name</label>
                    <input class="form-control" type="text" [value]="getItem().full_element['name']" [(ngModel)]="getItem().full_element['name']">
                  </div>
                  <div class="col-6 form-group">
                    <label class="text-primary-ab">Label</label>
                    <input class="form-control" type="text" [value]="getItem().full_element['label']" [(ngModel)]="getItem().full_element['label']">
                  </div>
                </div>
                <div class="row mt-4">
                  <div class="col-12 form-group">
                    <label class="text-primary-ab">Description</label>
                    <textarea class="form-control" rows="8" [value]="getItem().full_element['description']" [(ngModel)]="getItem().full_element['description']"></textarea>
                  </div>
                </div>
                <div class="row mt-4">
                  <div class="col-6 form-group">
                    <label class="text-primary-ab">Placeholder</label>
                    <input class="form-control" type="text" [value]="getItem().full_element['placeholder']" [(ngModel)]="getItem().full_element['placeholder']">
                  </div>
                  <div class="col-6 form-group">
                    <label class="text-primary-ab">Href</label>
                    <input class="form-control" type="text" [value]="getItem().full_element['href']" [(ngModel)]="getItem().full_element['href']">
                  </div>
                </div>
                <div class="row mt-4">
                  <div class="col-12 form-group">
                    <label class="text-primary-ab">Children Ref</label>

                    <div class="rounded w-100">
                      <mat-select class="form-control mb-2" [(ngModel)]="getItem().childrenRef" multiple>
                        <mat-option *ngFor="let child of mapChildrenRefList(allFormItemsMappedFiltered)" [value]="child" (click)="addChildrenRef(child)" (mouseover)="crColor = child?.color" (mouseout)="crColor = ''">
                          <div class="d-flex">
                            <div class="my-auto mx-3">{{ child.inputType }}</div>
                            <div class="my-auto" [style]="'height: 20px; width: 20px; border-radius: 50%;background-color: ' + child?.color + ' !important;'">&nbsp;</div>
                          </div>
                        </mat-option>
                      </mat-select>

                      <mat-chip-list>
                        <mat-chip *ngFor="let chip of getItem().childrenRef; let iC = index;">
                          <div class="d-flex">
                            <span class="my-auto" [style]="'height: 18px; width: 18px; border-radius: 50%;' + 'background-color: ' + chip.color +'!important;'">
                              &nbsp;
                            </span>
                            <span class="my-auto mx-3">
                              {{ chip.inputType }}
                            </span>
                          </div>
                          <button class="mb-1" matChipRemove (click)="chipRemove(chip)">
                            <i-bs
                              name="x-circle"
                              class="text-primary"
                              width="22px"
                              height="22px"
                            ></i-bs>
                          </button>
                        </mat-chip>
                      </mat-chip-list>

                    </div>


                  </div>
                </div>
                <div class="row mt-4">
                  <div class="col-12 form-group">
                    <label class="text-primary-ab">Options</label>
                    <div class="list-group">
                      <div class="list-group-item cursor-p border border-primary d-flex justify-content-around" *ngFor="let otpion of getItem().full_element['options']; let iO = index">
<!--  -->
                        <div class="w-100 my-auto">
                          <label class="text-primary-ab">Option Type</label>
                          <input class="form-control" type="text" [disabled]="getItem().special" [value]="otpion.optionType" [(ngModel)]="otpion.optionType">
                        </div>
                        <div class="w-100 my-auto mx-4">
                          <label class="text-primary-ab">Type Value</label>
                          <mat-select class="form-control" name="types" id="types" [disabled]="getItem().special" [value]="otpion.typeValue" [(ngModel)]="otpion.typeValue" (selectionChange)="otpion.value = null">
                            <mat-option [value]="type.value" *ngFor="let type of typesTypes">{{ type.key | titlecase }}</mat-option>
                          </mat-select>
                        </div>
                        <div class="w-100 my-auto d-flex justify-content-between">
                          <div class="my-auto w-75">
                            <label class="text-primary-ab">Value</label>
                            <input *ngIf="otpion.typeValue === 'string' || otpion.typeValue === 'number'" [disabled]="getItem().special" class="form-control" [type]="otpion.typeValue" [value]="otpion.value" [(ngModel)]="otpion.value">
                            <div class="" *ngIf="otpion.typeValue === 'boolean'">
                              <div class="rounded p-2 text-center " for="enabled" [ngClass]="otpion.value ? ' border border-primary text-primary-ab bg-dark-light-ab' : ' border '" (click)="getItem().special ? null : (otpion.value = !otpion.value)">
                                {{ otpion.value ? otpion.value : false }}
                              </div>
                            </div>
                          </div>
                          <div class="my-auto p-2 mt-4 mb-1 rounded border " [ngClass]="getItem().special || (getItem().special && getItem().lengthOptions < 2) ? ' border-muted' : ' border-danger'" (click)="getItem().special || (getItem().special && getItem().lengthOptions < 2) ? null : optionActions(iO)">
                            <i-bs
                              name="x-circle"
                              [ngClass]="getItem().special || (getItem().special && getItem().lengthOptions < 2) ? 'text-muted' : 'text-danger'"
                              width="22px"
                              height="22px"
                            ></i-bs>
                          </div>
                        </div>
<!--  -->
                      </div>
                      <div class="list-group mt-2" *ngIf="getItem().full_element['options'].length === 0">
                        <div class="list-group-item border border-danger text-danger bg-danger-light-ab">
                          <div class="d-flex justify-content-between">
                            <span class="my-auto">No options</span>
                            <i-bs
                              name="view-list"
                              class="my-auto"
                              width="24px"
                              height="24px"
                            ></i-bs>
                          </div>
                        </div>
                      </div>
                      <div class="list-group mt-2" *ngIf="!getItem().specialOptions">
                        <div class="list-group-item cursor-p border border-primary text-primary-ab bg-dark-light-ab" (click)="optionActions()">
                          <div class="d-flex justify-content-between">
                            <span class="my-auto">Add option</span>
                            <i-bs
                              name="node-plus"
                              class="my-auto"
                              width="28px"
                              height="28px"
                            ></i-bs>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row mt-4">
                  <div class="col-12 form-group">
                    <label class="text-primary-ab">Validation Pattern</label>
                    <input class="form-control" type="text" [value]="getItem().full_element['validation']" [(ngModel)]="getItem().full_element['validation']">
                  </div>
                </div>

              </div>
              <div class="card-footer mb-5 pb-2">
                <button class="btn btn-lg border border-success w-100 mt-auto text-success" [disabled]="getItem().id === undefined" (click)="dialogAlertMessage('Save Form Item', 'Are you sure you want to save this field?', 'check-circle-fill', 'save-field')">SAVE FORM ITEM DETAIL {{ getItem().id }}</button>
              </div>
            </div>

          </div>
        </ng-container>
      </div>
    </div>
  </ng-container>
</div>
